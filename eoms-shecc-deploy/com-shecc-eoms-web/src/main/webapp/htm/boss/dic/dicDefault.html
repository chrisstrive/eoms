<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title></title>
<link rel="stylesheet" type="text/css" href="<@sp.contextPath/>/static/jquery/css/pagination.css"/>
<link rel="stylesheet" type="text/css" href="<@sp.contextPath/>/static/boss/css/poss.css"/>
<script src="<@sp.contextPath/>/static/jquery/plugins/jquery-1.2.6.pack.js" type="text/javascript"/>
<script type="text/javascript" src="<@sp.contextPath/>/static/jquery/jquery.js"></script>
<script src="<@sp.contextPath/>/static/jquery/plugins/jquery.pagination.js" type="text/javascript"></script>
<script type="text/javascript" src="<@sp.contextPath/>/static/boss/js/My97DatePicker/WdatePicker.js"></script>
<style type="text/css">  
     .popup  
     {  
         border:1px solid red;  
         position:absolute;  
         top:0px;  
         left:0px;  
         width:100%;  
         height:100%;  
         background-color:#000;  
         filter:alpha(opacity=45);  
         opacity:0.45;  
         display:none;  
         z-index:200;  
     }  
     .fff  
     {  
         border:1px solid blue;  
         position:relative;  
         background-color:#000;  
     }  
     .searchBtn {
		 color: #FFFFFF;
		 background-image: url("<@sp.contextPath/>/static/boss/img/search.jpg");
		 line-height: 28px;
		 height: 28px;
		 width: 30px;
		 margin: 0px 0 0 0px; /*margin-top 和 margin-left 一句就可以实现了 */
		 border: none; /* border-top\left\right\bottom 也可以缩到一句 */
		 cursor:pointer
	}
 </style>
<script type="text/javascript">
/**
*	锁屏
*/
function lockScreen(){
	$("#popupDiv").show();  
}

/**
*	解锁
*/
function unLockScreen(){
	$("#popupDiv").hide();  
}
//翻页响应
function pageselectCallback(page_id,jq) {
    initData(page_id);
}

/**
*	表单校验
*/
function validateForm(){
	return true;
}

/**
 * 改变每页显示条数
 */
$(function() {      
    $("#items_per_page").bind("change keyup", function() {  
    	initData(0);
    });   
});

function initData(pageindx){
  var tbody = "";
  var pageCount = "";
  // 获取每页显示记录数
  var pageSize = $("#items_per_page").val();
  $.ajax({
       type: "POST",//用POST方式传输
       dataType:"json",//数据格式:JSON
       url:'<@sp.contextPath/>/dicDefault.htm?method=queryForPage',//目标地址
       async:false,//作用是防止在ajax成功调用之前就调用$("#Pagination").pagination,这个时候数据个数还没有初始化
       data:"targetPage=" + (pageindx+1) 
       		+ "&pageSize=" + pageSize
       		+ "&type=" + $("#type").val()+ "&dicTxt=" + $("#dicTxt").val(),
       beforeSend:function(){
	    	// 表单校验	
	       	if(!validateForm()){
	       		return false;
	       	}
       },//发送数据之前
       complete:function(){$("#divload").hide();$("#Pagination").show();},//接收数据完毕
       success:function(json) {
                $("#dataTable tr:gt(0)").remove();
                var pageData = json.pageData;
                pageCount = json.pageCount;
                $("#totalRecord").html(pageCount);
                if(pageData==""){
                   $("#divload").hide();
                //   dis();
                   return false;
                }
                $.each(pageData, function(i, data) {
                    var trs = "";
                    trs += "<tr>" + 
                    		"<td align='center'>" 
                    		 + (data.note == null ? "" : data.note) + 
                    		"</td>" +
                    		"<td align='center'>" + 
                    		(data.dicTxt == null ? "" : data.dicTxt) + 
                    		"</td>" +
                    		"<td align='center'>" +
                    		"<a href=\"javascript:edit('" + data.dicId + "')\">编辑</a>&nbsp;<a href=\"javascript:deleteDic('" + data.dicId + "')\">删除</a>" +
                    		"</td>" +
                    		"</tr>";
                 tbody+=trs; 
                });

                  $("#dataTable").append(tbody);
                 //行交替颜色
                  $("#dataTable tr:gt(0):odd").attr("class", "");
                  $("#dataTable tr:gt(0):even").attr("class", "");
                }//end of success
        });
		$("#Pagination").pagination(pageCount, {
		       callback: pageselectCallback,
		       prev_text: '<<上一页',
		       next_text: '下一页 >>',
		       items_per_page:pageSize,
		       num_display_entries:6,
		       current_page:pageindx,
		       num_edge_entries:2
		});
}

function formatStatus(status){
	if(status == "1"){
		return "有效";
	}
	if(status == "2"){
		return "冻结";
	}
}

function selectIds(obj){
	var ids = document.getElementsByName("loginId");
	for(var i = 0; i < ids.length; i++){
		ids[i].checked = false;
	}
	obj.checked = true;
}

function checkSelect(){
	var checkSelect = false;
	var id = "";
	var ids = document.getElementsByName("loginId");
	for(var i = 0; i < ids.length; i++){
		if(ids[i].checked){
			id = ids[i].value;
			checkSelect = true;
		}
	}
	if(!checkSelect){
		return null;
	}else{
		return id;
	}
}

/**
 * 新增
 */
function create() {
	var url = "<@sp.contextPath/>/dicDefault.htm?method=addDic";
	location.href = url;
	//window.showModalDialog(url, "新建", "dialogWidth:1000px;dialogHeight:auto;status:no;help:no;resizable:yes;");
}

/**
 * 修改
 */
function edit(id){
	var url = "<@sp.contextPath/>/dicDefault.htm?method=addDic&id=" + id;
	location.href = url;
	//window.showModalDialog(url, "编辑", "dialogWidth:1000px;dialogHeight:auto;status:no;help:no;resizable:yes;");
}

/**
 * 禁用角色
 */
function deleteDic(id){
	$.ajax({  
        type : 'post',  
        url : '<@sp.contextPath/>/dicDefault.htm?method=deleteDic&id=' + id,
        dataType : 'json',  
        beforeSend:function(){
        	if(confirm("是否确认删除该条字典?")){
        		return true;
        	}else {
        		return false;
        	}
        },//发送数据之前
        complete:function(){
        },//接收数据完毕
        success : function (xmlq) {  
        	var returnCode = xmlq.returnCode;
        	var description = xmlq.description;
        	if(returnCode == "0000"){
        		alert("数据字典删除成功!");
        		initData(0);
        	}else{
        		alert(description);
        	}
        },  
        error : function (xmlq, errq) {  
            alert("系统错误");  
        }  
    })
}

function refreshCache(){
	$.ajax({  
        type : 'post',  
        url : '<@sp.contextPath/>/dicDefault.htm?method=refreshCache',
        dataType : 'json',  
        beforeSend:function(){
        	if(confirm("是否确认刷新?")){
        		return true;
        	}else {
        		return false;
        	}
        },//发送数据之前
        complete:function(){
        },//接收数据完毕
        success : function (xmlq) {  
        	var returnCode = xmlq.returnCode;
        	var description = xmlq.description;
        	if(returnCode == "0000"){
        		alert("刷新成功!");
        		initData(0);
        	}else{
        		alert(description);
        	}
        },  
        error : function (xmlq, errq) {  
            alert("系统错误");  
        }  
    })
}

function selectData(){
	var typeVal = $("#type").val();
	if(typeVal == "2"){	// 合作机构
		var url = "<@sp.contextPath/>/partnerinfodefault.htm?method=selectMethod";
		var childRst = window.showModalDialog(url, window, "dialogWidth:1100px;dialogHeight:auto;status:no;help:no;resizable:yes;");
		var childRstArry = childRst.split(":");
		$("#refnum").attr("value", childRstArry[0]);
		$("#refnumDis").attr("value", childRstArry[1]);
	}else{				// 商户
		var url = "<@sp.contextPath/>/mchtinfodefault.htm?method=selectMethod";
		var childRst = window.showModalDialog(url, window, "dialogWidth:1100px;dialogHeight:auto;status:no;help:no;resizable:yes;");
		var childRstArry = childRst.split(":");
		$("#refnum").attr("value", childRstArry[0]);
		$("#refnumDis").attr("value", childRstArry[1]);
	}
}

$(function() {      
    $("#type").bind("change keyup", function() {   
    	var typeVal = $("#type").val();
		if(typeVal == "2"
				|| typeVal == "3"){
			$("#refnumDiv").show();
		}else{
			$("#refnumDiv").hide();
		}
		$("#refnumDis").attr("value", "");
		$("#refnum").attr("value", "");
	});
});

function viewUserRole(){
	var loginId = checkSelect();
	if(loginId == null){
		alert("请选择一条记录!");
		return;
	}
	var strArr = loginId.split(":");
	var url = "<@sp.contextPath/>/authdefault.htm?method=queryUserRole&loginId=" + strArr[0];
	location.href = url;
}
</script>
</head>
<body>
	<!--mod_box -->
	<div class="mod_box">
		<div class="head">字典查询</div>
		<form id="queryForm" name="queryForm" action="">
		<div class="body">
				<ul class="mod_list mod_list_multi">
					<li><label class="mod_side">字典类型：</label> 
					<select class="inp_normal w200" name="type" id="type">
						<option value="">请选择</option>
  						<#if dicTypeList?exists>
	  						<#list dicTypeList as dicType>
								<option value="${dicType.type}">${dicType.note}</option>
							</#list>
						</#if>
					</select>
					</li>	
					<li><label class="mod_side">字典名：</label> 
					<input type="text" class="inp_normal w200" name="dicTxt" id="dicTxt"/>
					</li>				
					<li class="mod_list_btn"><input class="btn btnA" type="button"
						value="查 询"  onclick="initData(0)"/>
					</li>
				</ul>
		</div>
		</form>
	</div>
	<!--/mod_box -->

	<!--mod_box -->
	<div class="mod_box">
		<div class="body">
			<p class="mb10">
			<span class="f14b">
			<input class="btn btnA" type="button" value="新增字典" onclick="create()"/>&nbsp;
			<!-- <input class="btn btnA" type="button" value="删除字典" onclick="fobitUser()"/> -->
			
			</span>
			</p>
			<table class="table txtC" id="dataTable">
				<thead>
					<tr>
						<th>字典类型</th>
						<th>字典名</th>
						<th>操作</th>
					</tr>
				</thead>
			</table>
			<div>
			<table width="100%">
				<tr>
					<td width="20%" align="left">每页显示<select id="items_per_page" style="cursor:pointer"><option value="10">10</option><option value="20">20</option><option value="50">50</option></select> 条 ,共<label id="totalRecord">0</label>条记录</td><td align="right"><div id="Pagination" class="flickr" style="text-align:right"></div></td>
				</tr>
			</table>
			<div id="divload" style="top:50%; right:50%;position:absolute; padding:0px; margin:0px; z-index:999"></div>
			</div>
		</div>
	</div>
	<div class="popup" id="popupDiv">  
      <!--IE6下，DIV默认不能遮盖select标签，可在此处放置一个iframe，以达到遮盖效果，其他浏览器可以不要-->  
      <iframe frameborder="1" scrolling="no" height="100%" width="100%" class="fff"></iframe>  
</div>
	<!--/mod_box -->
</body>
<script>
// 异步查询方法
initData(0);
</script>
</html>
